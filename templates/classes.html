<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Class</title>
    <link rel="stylesheet" href="/static/plugins/bootstrap-3.3.7-dist/css/bootstrap.css" />
    <link rel="stylesheet" href="/static/plugins/fontawesome-free-5.4.1-web/css/all.css" />
    <style>
        .hide{
            display: none;
        }
        .shadow{
            position: fixed;
            left: 0;
            top: 0;
            right: 0;
            bottom: 0;
            background-color: black;
            opacity: 0.4;
            z-index: 99;<!-- 值越大对话框越在上层 -->
        }
        .modal{
            position: fixed;
            left: 50%;  <!-- 距离左边框半个浏览器的距离 -->
            top: 50%;
            height : 300px;
            width : 400px;
            background-color: white;
            margin-left: -200px;
            margin-top: -300px;
            z-index: 100;

        }
        .class_shadow{
            position: fixed;
            left: 0;
            top: 0;
            right: 0;
            bottom: 0;
            background-color: black;
            opacity: 0.4;
            z-index: 99;<!-- 值越大对话框越在上层 -->
        }
        .class_modal{
            position: fixed;
            left: 50%;  <!-- 距离左边框半个浏览器的距离 -->
            top: 50%;
            height : 300px;
            width : 400px;
            background-color: white;
            margin-left: -200px;
            margin-top: -300px;
            z-index: 100;

        }
    </style>

</head>
<body>
    <div style="width: 700px; margin: 0 auto">
        <h1>班级列表</h1>
        <div style="margin: 10px 0px;">
        <a href="/add_class/" class="btn btn-primary">添加</a>
        <a onclick="showModal();" class="btn btn-info">对话框添加</a>
        </div>

        <table class="table table-striped table-bordered table-hover">
            <thead>
            <tr>
                <td>ID</td>
                <td>名称</td>
                <td>操作</td>
            </tr>
            </thead>
            {% for row in classes_data %}
            <tr>
                <td>{{ row.id }}</td>
                <td>{{ row.name }}</td>
                <td>
                    <a href="/edit_class/?nid={{ row.id }}" class="glyphicon glyphicon-pencil"></a> |
                    <a class="fa fa-battery-full" onclick="modelEditClass(this);">对话框编辑</a> |
                    <a href="/del_class/?nid={{ row.id }}" class="glyphicon glyphicon-trash"></a>
                </td>
            </tr>
            {% endfor %}
        </table>
    <div/>
    <div id="shadow" class="shadow hide"></div>
    <div id="modal" class="modal hide">
    <form method="POST" action="/modal_add_class/">
        <p>班级名称<input id="name" type="text" name="name"></p>

        <input type="button" value="提交" onclick="AjaxSend();"/>
        <span id="error_msg"></span>
        <input type="button" value="取消" onclick="CancelModal();"/>
    </form>
    </div>
    <!--
    <script src="http://code.jquery.com/jquery-1.12.4.min.js"></script>
    -->
    <div id="class_shadow" class="class_shadow hide"></div>
    <div id="class_modal" class="class_modal hide">
        <h3>编辑框</h3>
            <p>S名称<input id="edit_class_name" type="text" name="name"></p>

            <input type="button" value="提交" onclick="class_AjaxSend();"/>
            <input type="button" value="取消" onclick="CancelModal();"/>
            <span id="error_msg"></span>
    </div>


    <script src="/static/jquery-1.12.4.min.js"></script>
    <script>
        function showModal() {
            document.getElementById('shadow').classList.remove('hide')
            document.getElementById('modal').classList.remove('hide')
        }
        function CancelModal() {
            document.getElementById('shadow').classList.add('hide')
            document.getElementById('modal').classList.add('hide')
            document.getElementById('class_modal').classList.add('hide')
            document.getElementById('class_shadow').classList.add('hide')
        }
        function AjaxSend() {
            $.ajax({
                url: '/modal_add_class/',
                type: 'POST',
                data: {'name' : $('#name').val()},
                // 拿到用户输入的值
                // <p>班级名称<input id="name" type="text" name="name"></p>
                success: function(data){
                    //当服务端处理完成后，返回数据时，自动调用该函数
                    //参数data为服务器返回的数据
                    console.log(data);
                    if(data == "ok"){
                        alert('添加成功');
                        location.href = '/classes/';
                    }
                    else{
                        // alert('添加失败');
                        $('#error_msg').text(data)
                    }
                }
                })
        }


        function modelEditClass(self) {
            document.getElementById('class_shadow').classList.remove('hide');
            document.getElementById('class_modal').classList.remove('hide');
            var row = $(self).parent().prevAll();
            var content = $(row[0]).text();
            $('#edit_class_name').val(content);
        }


    </script>
</body>

</html>